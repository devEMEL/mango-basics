{
  "version": 3,
  "sources": ["../../../src/cryptography/publickey.ts"],
  "sourcesContent": ["import { toB64 } from '@mgonetwork/bcs';\nimport { keccak_256 } from '@noble/hashes/sha3';\nimport { bytesToHex } from '@noble/hashes/utils';\n\nimport { bcs } from '../bcs/index.js';\nimport { MGO_ADDRESS_LENGTH, normalizeMgoAddress } from '../utils/mgo-types';\nimport type { SerializedSignature } from './index.js';\nimport { IntentScope, messageWithIntent } from './intent.js';\n\n/**\n * Value to be converted into public key.\n */\nexport type PublicKeyInitData = string | Uint8Array | Iterable<number>;\n\nexport function bytesEqual(a: Uint8Array, b: Uint8Array) {\n\tif (a === b) return true;\n\n\tif (a.length !== b.length) {\n\t\treturn false;\n\t}\n\n\tfor (let i = 0; i < a.length; i++) {\n\t\tif (a[i] !== b[i]) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\n/**\n * A public key\n */\nexport abstract class PublicKey {\n\t/**\n\t * Checks if two public keys are equal\n\t */\n\tequals(publicKey: PublicKey) {\n\t\treturn bytesEqual(this.toRawBytes(), publicKey.toRawBytes());\n\t}\n\n\t/**\n\t * Return the base-64 representation of the public key\n\t */\n\ttoBase64() {\n\t\treturn toB64(this.toRawBytes());\n\t}\n\n\t/**\n\t * @deprecated use toBase64 instead.\n\t *\n\t * Return the base-64 representation of the public key\n\t */\n\ttoString() {\n\t\treturn this.toBase64();\n\t}\n\n\t/**\n\t * Return the Mgo representation of the public key encoded in\n\t * base-64. A Mgo public key is formed by the concatenation\n\t * of the scheme flag with the raw bytes of the public key\n\t */\n\ttoMgoPublicKey(): string {\n\t\tconst bytes = this.toMgoBytes();\n\t\treturn toB64(bytes);\n\t}\n\n\tverifyWithIntent(\n\t\tbytes: Uint8Array,\n\t\tsignature: Uint8Array | SerializedSignature,\n\t\tintent: IntentScope,\n\t): Promise<boolean> {\n\t\tconst intentMessage = messageWithIntent(intent, bytes);\n\t\tconst digest = keccak_256(intentMessage);\n\n\t\treturn this.verify(digest, signature);\n\t}\n\n\t/**\n\t * Verifies that the signature is valid for for the provided PersonalMessage\n\t */\n\tverifyPersonalMessage(\n\t\tmessage: Uint8Array,\n\t\tsignature: Uint8Array | SerializedSignature,\n\t): Promise<boolean> {\n\t\treturn this.verifyWithIntent(\n\t\t\tbcs.ser(['vector', 'u8'], message).toBytes(),\n\t\t\tsignature,\n\t\t\tIntentScope.PersonalMessage,\n\t\t);\n\t}\n\n\t/**\n\t * Verifies that the signature is valid for for the provided TransactionBlock\n\t */\n\tverifyTransactionBlock(\n\t\ttransactionBlock: Uint8Array,\n\t\tsignature: Uint8Array | SerializedSignature,\n\t): Promise<boolean> {\n\t\treturn this.verifyWithIntent(transactionBlock, signature, IntentScope.TransactionData);\n\t}\n\n\t/**\n\t * Returns the bytes representation of the public key\n\t * prefixed with the signature scheme flag\n\t */\n\ttoMgoBytes(): Uint8Array {\n\t\tconst rawBytes = this.toRawBytes();\n\t\tconst mgoBytes = new Uint8Array(rawBytes.length + 1);\n\t\tmgoBytes.set([this.flag()]);\n\t\tmgoBytes.set(rawBytes, 1);\n\n\t\treturn mgoBytes;\n\t}\n\n\t/**\n\t * @deprecated use `toRawBytes` instead.\n\t */\n\ttoBytes() {\n\t\treturn this.toRawBytes();\n\t}\n\n\t/**\n\t * Return the Mgo address associated with this Ed25519 public key\n\t */\n\ttoMgoAddress(): string {\n\t\t// Each hex char represents half a byte, hence hex address doubles the length\n\t\treturn normalizeMgoAddress(\n\t\t\tbytesToHex(keccak_256(this.toMgoBytes())).slice(0, MGO_ADDRESS_LENGTH * 2),\n\t\t);\n\t}\n\n\t/**\n\t * Return the byte array representation of the public key\n\t */\n\tabstract toRawBytes(): Uint8Array;\n\n\t/**\n\t * Return signature scheme flag of the public key\n\t */\n\tabstract flag(): number;\n\n\t/**\n\t * Verifies that the signature is valid for for the provided message\n\t */\n\tabstract verify(data: Uint8Array, signature: Uint8Array | SerializedSignature): Promise<boolean>;\n}\n"],
  "mappings": "AAAA,SAAS,aAAa;AACtB,SAAS,kBAAkB;AAC3B,SAAS,kBAAkB;AAE3B,SAAS,WAAW;AACpB,SAAS,oBAAoB,2BAA2B;AAExD,SAAS,aAAa,yBAAyB;AAOxC,SAAS,WAAW,GAAe,GAAe;AACxD,MAAI,MAAM;AAAG,WAAO;AAEpB,MAAI,EAAE,WAAW,EAAE,QAAQ;AAC1B,WAAO;AAAA,EACR;AAEA,WAAS,IAAI,GAAG,IAAI,EAAE,QAAQ,KAAK;AAClC,QAAI,EAAE,CAAC,MAAM,EAAE,CAAC,GAAG;AAClB,aAAO;AAAA,IACR;AAAA,EACD;AACA,SAAO;AACR;AAKO,MAAe,UAAU;AAAA;AAAA;AAAA;AAAA,EAI/B,OAAO,WAAsB;AAC5B,WAAO,WAAW,KAAK,WAAW,GAAG,UAAU,WAAW,CAAC;AAAA,EAC5D;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW;AACV,WAAO,MAAM,KAAK,WAAW,CAAC;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,WAAW;AACV,WAAO,KAAK,SAAS;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,iBAAyB;AACxB,UAAM,QAAQ,KAAK,WAAW;AAC9B,WAAO,MAAM,KAAK;AAAA,EACnB;AAAA,EAEA,iBACC,OACA,WACA,QACmB;AACnB,UAAM,gBAAgB,kBAAkB,QAAQ,KAAK;AACrD,UAAM,SAAS,WAAW,aAAa;AAEvC,WAAO,KAAK,OAAO,QAAQ,SAAS;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA,EAKA,sBACC,SACA,WACmB;AACnB,WAAO,KAAK;AAAA,MACX,IAAI,IAAI,CAAC,UAAU,IAAI,GAAG,OAAO,EAAE,QAAQ;AAAA,MAC3C;AAAA,MACA,YAAY;AAAA,IACb;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,uBACC,kBACA,WACmB;AACnB,WAAO,KAAK,iBAAiB,kBAAkB,WAAW,YAAY,eAAe;AAAA,EACtF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,aAAyB;AACxB,UAAM,WAAW,KAAK,WAAW;AACjC,UAAM,WAAW,IAAI,WAAW,SAAS,SAAS,CAAC;AACnD,aAAS,IAAI,CAAC,KAAK,KAAK,CAAC,CAAC;AAC1B,aAAS,IAAI,UAAU,CAAC;AAExB,WAAO;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU;AACT,WAAO,KAAK,WAAW;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKA,eAAuB;AAEtB,WAAO;AAAA,MACN,WAAW,WAAW,KAAK,WAAW,CAAC,CAAC,EAAE,MAAM,GAAG,qBAAqB,CAAC;AAAA,IAC1E;AAAA,EACD;AAgBD;",
  "names": []
}
